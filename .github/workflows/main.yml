name: CI
on:
  push:
    branches:
      - main
jobs:
  deploy:
    runs-on: self-hosted
    env: {}
    steps:
    - name: pull request
      run: |
           cd /
           cd /opt/darkertrade/
           git pull
    - name: update FE
      run: |
          cd /
          cd /opt/darkertrade/
          cd frontend
          pnpm i  
    - name: update BE
      run: |
          cd /
          cd /opt/darkertrade/
          cd backend
          pnpm i 
    - name: build BE
      run: |
          cd /
          cd /opt/darkertrade/
          cd backend
          nest build
    - name: build FE
      run: |
          cd /
          cd /opt/darkertrade/
          cd frontend
          pnpm run build
    - name: delete PM2
      run: pm2 delete all
    - name: restart PM2
      env: {}
      run: pm2 start /opt/darkertrade/ecosystem.config.js
    
